{"version":3,"sources":["auth/local/passport.js"],"names":[],"mappings":";;;;;QA2BgB,K,GAAA,K;;AA3BhB;;;;AACA;;;;AAEA,SAAS,iBAAT,CAA2B,IAA3B,EAAiC,KAAjC,EAAwC,QAAxC,EAAkD,IAAlD,EAAwD;AACtD,OAAK,OAAL,CAAa;AACX,WAAO,MAAM,WAAN;AADI,GAAb,EAEG,IAFH,GAGG,IAHH,CAGQ,gBAAQ;AACZ,QAAI,CAAC,IAAL,EAAW;AACT,aAAO,KAAK,IAAL,EAAW,KAAX,EAAkB;AACvB,iBAAS;AADc,OAAlB,CAAP;AAGD;AACD,SAAK,YAAL,CAAkB,QAAlB,EAA4B,UAAS,SAAT,EAAoB,aAApB,EAAmC;AAC7D,UAAI,SAAJ,EAAe;AACb,eAAO,KAAK,SAAL,CAAP;AACD;AACD,UAAI,CAAC,aAAL,EAAoB;AAClB,eAAO,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAE,SAAS,+BAAX,EAAlB,CAAP;AACD,OAFD,MAEO;AACL,eAAO,KAAK,IAAL,EAAW,IAAX,CAAP;AACD;AACF,KATD;AAUD,GAnBH,EAoBG,KApBH,CAoBS;AAAA,WAAO,KAAK,GAAL,CAAP;AAAA,GApBT;AAqBD;;AAEM,SAAS,KAAT,CAAe,IAAf,EAAqB,MAArB,EAA6B;AAClC,qBAAS,GAAT,CAAa,4BAAkB;AAC7B,mBAAe,OADc;AAE7B,mBAAe,U;AAFc,GAAlB,EAGV,UAAS,KAAT,EAAgB,QAAhB,EAA0B,IAA1B,EAAgC;AACjC,WAAO,kBAAkB,IAAlB,EAAwB,KAAxB,EAA+B,QAA/B,EAAyC,IAAzC,CAAP;AACD,GALY,CAAb;AAMD","file":"auth/local/passport.js","sourcesContent":["import passport from 'passport';\r\nimport {Strategy as LocalStrategy} from 'passport-local';\r\n\r\nfunction localAuthenticate(User, email, password, done) {\r\n  User.findOne({\r\n    email: email.toLowerCase()\r\n  }).exec()\r\n    .then(user => {\r\n      if (!user) {\r\n        return done(null, false, {\r\n          message: 'This email is not registered.'\r\n        });\r\n      }\r\n      user.authenticate(password, function(authError, authenticated) {\r\n        if (authError) {\r\n          return done(authError);\r\n        }\r\n        if (!authenticated) {\r\n          return done(null, false, { message: 'This password is not correct.' });\r\n        } else {\r\n          return done(null, user);\r\n        }\r\n      });\r\n    })\r\n    .catch(err => done(err));\r\n}\r\n\r\nexport function setup(User, config) {\r\n  passport.use(new LocalStrategy({\r\n    usernameField: 'email',\r\n    passwordField: 'password' // this is the virtual field on the model\r\n  }, function(email, password, done) {\r\n    return localAuthenticate(User, email, password, done);\r\n  }));\r\n}\r\n"],"sourceRoot":"/source/"}